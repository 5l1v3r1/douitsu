!function(){var n=angular.module("account",["ngRoute","cookiesModule","senecaSettingsModule"]).config(["$routeProvider",function(n){n.when("/Applications",{tab:"Applications"}).when("/Settings",{tab:"Settings"}).when("/Account",{tab:"Account"}).otherwise({tab:"Dashboard"})}]),t={unknown:"Unable to perform your request at this time - please try again later.","user-updated":"Your user details have been updated.","user-exists-email":"A user with that email already exists.","user-exists-nick":"A user with that username already exists.","password-updated":"Your password has been updated.","org-updated":"Your organisations details have been updated.","application-updated":"Application updated.","application-deleted":"Application deleted."};n.service("auth",function(n,t){return{instance:function(t,i){n({method:"GET",url:"/auth/instance",cache:!1}).success(function(n){return t?t(n):void 0}).error(function(n){return i?i(n):void 0})},logout:function(i,e){n({method:"POST",url:"/auth/logout",cache:!1}).success(function(n){return i?i(n):t.location.href="/"}).error(function(n){return e?e(n):void 0})},change_password:function(t,i,e){n({method:"POST",url:"/auth/change_password",data:t,cache:!1}).success(function(n){return i?i(n):void 0}).error(function(n){return e?e(n):void 0})},update_user:function(t,i,e){n({method:"POST",url:"/auth/update_user",data:t,cache:!1}).success(function(n){return i?i(n):void 0}).error(function(n){return e?e(n):void 0})},update_org:function(t,i,e){n({method:"POST",url:"/account/update",data:t,cache:!1}).success(function(n){return i?i(n):void 0}).error(function(n){return e?e(n):void 0})}}}),n.service("api",function(n){return{get:function(n,t,i){this.call("GET",n,null,null,t,i)},post:function(n,t,i,e){this.call("POST",n,t,null,i,e)},del:function(n,t,i){this.call("DELETE",n,null,null,t,i)},call:function(t,i,e,o,a,u){var c={method:t,url:i,data:e,cache:!1};n(c).success(function(n){return a?a(n):void 0}).error(function(n){return u?u(n):void 0})}}}),n.service("pubsub",function(){var n={};return{publish:function(t,i){n[t]&&$.each(n[t],function(){this.apply(null,i||[])})},subscribe:function(t,i){return n[t]||(n[t]=[]),n[t].push(i),[t,i]},unsubscribe:function(t){var i=t[0];n[i]&&d.each(n[i],function(e){this==t[1]&&n[i].splice(e,1)})}}}),n.controller("Main",function(n,t,i){t.instance(function(t){n.user=t.user,n.account=t.account,i.publish("user",[t.user]),i.publish("account",[t.account])}),i.subscribe("user",function(t){n.user=t})}),n.controller("NavBar",function(n,t,i){n.btn_account=function(){i.publish("view",["Account"])},n.btn_signout=function(){t.logout()}}),n.controller("Account",function(n,i,e){function o(){return{name:n.field_name,email:n.field_email}}function a(){return{password:n.field_password,repeat:n.field_repeat}}function u(){return{name:n.field_org_name,web:n.field_org_web}}i.subscribe("view",function(n){}),i.subscribe("user",function(t){n.field_name=t.name,n.field_email=t.email}),i.subscribe("account",function(t){n.field_org_name=t.name,n.field_org_web=t.web}),n.update_user=function(){var a=o();e.update_user(a,function(e){n.details_msg=t["user-updated"],i.publish("user",[e.user])},function(i){n.details_msg=t[i.why]||t.unknown})},n.change_pass=function(){var i=a();e.change_password(i,function(){n.password_msg=t["password-updated"]},function(i){n.password_msg=t[i.why]||t.unknown})},n.update_org=function(){var o=u();e.update_org(o,function(e){n.org_msg=t["org-updated"],i.publish("account",[e.account])},function(i){n.org_msg=t[i.why]||t.unknown})}}),n.controller("TabView",function(n,t,i,e){var o=["Dashboard","Applications","Settings","Account"];n.views=_.filter(o,function(n){return"Account"!=n}),e.subscribe("view",function(t){console.log("fired:"+t),_.each(o,function(i){n["show_view_"+i]=t==i}),n.curtab=t,i.path(t)}),n.tabview=function(n){e.publish("view",[n])},n.$on("$routeChangeSuccess",function(t,i){i.tab&&n.curtab!=i.tab&&n.tabview(i.tab)})}),n.controller("Applications",function(n,i,e){function o(){i.get("/api/rest/application",function(t){n.applications=t})}function a(){return{name:n.field_name,homeurl:n.field_homeurl}}n.applications=[],n.show_applications_list=!0,n.show_application_details=!1,n.new_application=function(){n.open_application()},n.open_application=function(t){void 0!=t?i.get("/api/rest/application/"+t,function(t){n.show_application(t)}):n.show_application()},n.show_application=function(t){n.application=t=t||{},n.field_name=t.name,n.field_code=t.code,n.show_applications_list=!1,n.show_application_details=!0,n.application_msg=null},n.close_application=function(){n.show_applications_list=!0,n.show_application_details=!1},n.save_application=function(){n.application=_.extend(n.application,a()),i.post("/api/rest/application",n.application,function(i){n.show_application(i),n.application_msg=t["application-updated"],e.publish("application.change",[i])},function(i){n.application_msg=t[i.why]||t.unknown})},n.delete_application=function(o){confirm("Are you sure?")&&i.del("/api/rest/application/"+o,function(){n.application_msg=t["application-deleted"],e.publish("application.change",[])},function(i){n.application_msg=t[i.why]||t.unknown})},o(),e.subscribe("application.change",o)})}();