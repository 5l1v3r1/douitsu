!function(){var n=angular.module("account",["ngRoute","cookiesModule","senecaSettingsModule"]).config(["$routeProvider",function(n){n.when("/Applications",{tab:"Applications"}).when("/Settings",{tab:"Settings"}).when("/Account",{tab:"Account"}).otherwise({tab:"Applications"})}]),t={unknown:"Unable to perform your request at this time - please try again later.","user-updated":"Your user details have been updated.","user-exists-email":"A user with that email already exists.","user-exists-nick":"A user with that username already exists.","password-updated":"Your password has been updated.","org-updated":"Your organisations details have been updated.","application-updated":"Application updated.","application-deleted":"Application deleted.","token-deleted":"Token deleted."};n.service("auth",["$http","$window",function(n,t){return{instance:function(t,i){n({method:"GET",url:"/auth/instance",cache:!1}).success(function(n){return t?t(n):void 0}).error(function(n){return i?i(n):void 0})},logout:function(i,e){n({method:"POST",url:"/auth/logout",cache:!1}).success(function(n){return i?i(n):t.location.href="/"}).error(function(n){return e?e(n):void 0})},change_password:function(t,i,e){n({method:"POST",url:"/auth/change_password",data:t,cache:!1}).success(function(n){return i?i(n):void 0}).error(function(n){return e?e(n):void 0})},update_user:function(t,i,e){n({method:"POST",url:"/auth/update_user",data:t,cache:!1}).success(function(n){return i?i(n):void 0}).error(function(n){return e?e(n):void 0})},update_org:function(t,i,e){n({method:"POST",url:"/account/update",data:t,cache:!1}).success(function(n){return i?i(n):void 0}).error(function(n){return e?e(n):void 0})}}}]),n.service("api",["$http","$window",function(n){return{get:function(n,t,i){this.call("GET",n,null,null,t,i)},post:function(n,t,i,e){this.call("POST",n,t,null,i,e)},del:function(n,t,i){this.call("DELETE",n,null,null,t,i)},call:function(t,i,e,a,o,c){var u={method:t,url:i,data:e,cache:!1};n(u).success(function(n){return o?o(n):void 0}).error(function(n){return c?c(n):void 0})}}}]),n.service("pubsub",function(){var n={};return{publish:function(t,i){n[t]&&$.each(n[t],function(){this.apply(null,i||[])})},subscribe:function(t,i){return n[t]||(n[t]=[]),n[t].push(i),[t,i]},unsubscribe:function(t){var i=t[0];n[i]&&d.each(n[i],function(e){this==t[1]&&n[i].splice(e,1)})}}}),n.controller("Main",["$scope","auth","pubsub",function(n,t,i){t.instance(function(t){n.user=t.user,n.account=t.account,i.publish("user",[t.user]),i.publish("account",[t.account])}),i.subscribe("user",function(t){n.user=t})}]),n.controller("NavBar",["$scope","auth","pubsub",function(n,t,i){n.btn_applications=function(){i.publish("view",["Applications"])},n.btn_account=function(){i.publish("view",["Account"])},n.btn_signout=function(){t.logout()}}]),n.controller("Account",["$scope","auth","pubsub",function(n,i,e){function a(){return{name:n.field_name,email:n.field_email,gravatar:n.field_gravatar,image:n.imageUrl}}function o(){return{password:n.field_password,repeat:n.field_repeat}}function c(){return{name:n.field_org_name,web:n.field_org_web}}e.subscribe("view",function(n){}),e.subscribe("user",function(t){n.field_name=t.name,n.field_email=t.email,n.field_gravatar=t.gravatar,n.field_image=t.image}),e.subscribe("account",function(t){n.field_org_name=t.name,n.field_org_web=t.web}),n.update_user=function(){var o=a();i.update_user(o,function(i){n.details_msg=t["user-updated"],e.publish("user",[i.user])},function(i){n.details_msg=t[i.why]||t.unknown})},n.change_pass=function(){var e=o();i.change_password(e,function(){n.password_msg=t["password-updated"]},function(i){n.password_msg=t[i.why]||t.unknown})},n.update_org=function(){var a=c();i.update_org(a,function(i){n.org_msg=t["org-updated"],e.publish("account",[i.account])},function(i){n.org_msg=t[i.why]||t.unknown})}}]),n.controller("TabView",["$scope","$route","$location","pubsub",function(n,t,i,e){var a=["Dashboard","Applications","Settings","Account"];n.views=_.filter(a,function(n){return"Account"!=n}),e.subscribe("view",function(t){console.log("fired:"+t),_.each(a,function(i){n["show_view_"+i]=t==i}),n.curtab=t,i.path(t)}),n.tabview=function(n){e.publish("view",[n])},n.$on("$routeChangeSuccess",function(t,i){i.tab&&n.curtab!=i.tab&&n.tabview(i.tab)})}]),n.directive("imageUrl",function(){return{restrict:"A",link:function(n,t){t.val(n.imageUrl),t.data("old-value",n.imageUrl),n.$watch("imageUrl",function(){t.val(n.imageUrl)}),t.bind("onchange propertychange keyup paste",function(){t.data("old-value")!=t.val()&&n.$apply(function(){n.imageUrl=t.val(),t.data("old-value",t.val())})})}}}),n.controller("Applications",["$scope","api","pubsub",function(n,i,e){function a(){o(),c()}function o(){i.get("/api/rest/application?account="+n.account.id,function(t){n.applications=t})}function c(){i.get("/api/user/token",function(t){n.tokens=t.tokens})}function u(){return{account:n.account.id,name:n.field_name,appid:n.appid,secret:n.secret,homeurl:n.field_homeurl,callback:n.field_callback,desc:n.field_desc,image:n.imageUrl}}n.applications=[],n.show_applications_list=!0,n.show_application_details=!1,n.new_application=function(){n.open_application()},n.open_application=function(t){void 0!=t?i.get("/api/rest/application/"+t,function(t){n.show_application(t)}):n.show_application()},n.show_application=function(t){n.application=t=t||{},n.field_name=t.name,n.field_homeurl=t.homeurl,n.field_callback=t.callback,n.field_desc=t.desc,n.appid=t.appid,n.secret=t.secret,n.show_applications_list=!1,n.show_application_details=!0,n.application_msg=null},n.close_application=function(){n.show_applications_list=!0,n.show_application_details=!1},n.save_application=function(){n.application=_.extend(n.application,u()),i.post("/api/rest/application",n.application,function(i){n.show_application(i),n.application_msg=t["application-updated"],e.publish("application.change",[i])},function(i){n.application_msg=t[i.why]||t.unknown})},n.delete_application=function(a){confirm("Are you sure?")&&i.del("/api/rest/application/"+a,function(){n.application_msg=t["application-deleted"],e.publish("application.change",[])},function(i){n.application_msg=t[i.why]||t.unknown})},n.revoke_token=function(a){confirm("Are you sure?")&&i.del("/api/user/token?access_token="+a,function(){e.publish("application.change",[])},function(i){n.token_msg=t[i.why]||t.unknown})},a(),e.subscribe("application.change",a)}])}();