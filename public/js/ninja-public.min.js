!function(){function e(e){return null==e||0==""+e}var n=angular.module("home",["cookiesModule","services.config"]);n.controller("Main",["$scope","$location","configuration",function(e,n,o){var s=window.location.pathname,i=!0,t=0==s.indexOf("/signup"),a=0==s.indexOf("/forgot"),r=0==s.indexOf("/reset"),u=0==s.indexOf("/confirm");return t&&!o.signup_enabled?window.location.href="/":(i=!(t||a||u||r),e.show_login=i,e.show_signup=t,e.show_forgot=a,e.show_reset=r,void(e.show_confirm=u))}]);var o={unknown:"Unable to perform your request at this time - please try again later.","missing-fields":"Please enter the missing fields.","user-not-found":"That email address is not recognized.","invalid-password":"That password is incorrect","mismatch-password":"Password mismatch","email-exists":"That email address is already in use. Please login, or ask for a password reset.","nick-exists":"That email address is already in use. Please login, or ask for a password reset.","reset-sent":"An email with password reset instructions has been sent to you.","activate-reset":"Please enter your new password.","invalid-reset":"This is not a valid reset.","reset-done":"Your password has been reset.",confirmed:"Your account has been confirmed","invalid-confirm-code":"That confirmation code is not valid."};n.service("auth",["$http","$window",function(e,n){return{login:function(o,s,i){e({method:"POST",url:"/auth/login",data:o,cache:!1}).success(function(e){return s?s(e):n.location.href="/account"}).error(function(e){return i?i(e):void 0})},register:function(o,s,i){e({method:"POST",url:"/auth/register",data:o,cache:!1}).success(function(e){return s?s(e):n.location.href="/account"}).error(function(e){return i?i(e):void 0})},instance:function(n,o){e({method:"GET",url:"/auth/instance",cache:!1}).success(function(e){return n?n(e):void 0}).error(function(e){return o?o(e):void 0})},reset:function(n,o,s){e({method:"POST",url:"/auth/create_reset",data:n,cache:!1}).success(function(e){return o?o(e):void 0}).error(function(e){return s?s(e):void 0})},reset_load:function(n,o,s){e({method:"POST",url:"/auth/load_reset",data:n,cache:!1}).success(function(e){return o?o(e):void 0}).error(function(e){return s?s(e):void 0})},reset_execute:function(n,o,s){e({method:"POST",url:"/auth/execute_reset",data:n,cache:!1}).success(function(e){return o?o(e):void 0}).error(function(e){return s?s(e):void 0})},confirm:function(n,o,s){e({method:"POST",url:"/auth/confirm",data:n,cache:!1}).success(function(e){return o?o(e):void 0}).error(function(e){return s?s(e):void 0})}}}]),n.controller("Login",["$scope","$rootScope","auth","configuration",function(n,s,i,t){function a(){return{email:!e(n.input_email),password:!e(n.input_password)}}function r(e,o){_.each(e,function(e,s){o&&o[s]||(n["seek_"+s]=!e)}),n.seek_signin=!e.email||!e.password,n.seek_send=!e.email}function u(){i.login({email:n.input_email,password:n.input_password},null,function(e){n.msg=o[e.why]||o.unknown,n.showmsg=!0,"user-not-found"==e.why&&(n.seek_email=!0),"invalid-password"==e.why&&(n.seek_password=!0)})}function c(){i.reset({email:n.input_email},function(){n.cancel(),n.msg=o["reset-sent"],n.showmsg=!0},function(e){n.msg=o[e.why]||o.unknown,n.showmsg=!0,"user-not-found"==e.why&&(n.seek_email=!0)})}n.signup_enabled=t.signup_enabled,n.signin=function(){n.showmsg=!1;var e=a();r(e,{}),e.email&&e.password?u():(n.msg=o["missing-fields"],n.showmsg=!0),n.signin_hit=!0,n.mode="signin"},n.send=function(){"send"!=n.mode&&show({name:!1,password:!1,signup:!1,signin:!1,cancel:!0,send:!0}),n.send_hit=!0,n.showmsg=!1;var e=a();e.email?c():r(e),n.mode="send"},n.forgot=function(){window.location.href="/forgot"},n.goaccount=function(){window.location.href="/account"},n.signup=function(){window.location.href="/signup"},n.user=null,n.showmsg=!1,n.signin_hit=!1,n.input_email="",n.input_password="",n.$watch("input_email",function(){n.seek_email=!1}),n.$watch("input_password",function(){n.seek_password=!1}),n.seek_email=!1,n.seek_password=!1,n.hasuser=!!n.user,i.instance(function(e){n.user=e.user,n.hasuser=!!n.user,s.$emit("instance",{user:e.user})})}]),n.directive("imageUrl",function(){return{restrict:"A",link:function(e,n){n.val(e.imageUrl),n.data("old-value",e.imageUrl),e.$watch("imageUrl",function(){n.val(e.imageUrl)}),n.bind("onchange propertychange keyup paste",function(){n.data("old-value")!=n.val()&&e.$apply(function(){e.imageUrl=n.val(),n.data("old-value",n.val())})})}}}),n.controller("Signup",["$scope","$rootScope","auth",function(n,s,i){function t(){return{name:!e(n.input_name),email:!e(n.input_email),password:!e(n.input_password),verify_password:!e(n.input_verify_password)}}function a(e,o){_.each(e,function(e,s){o&&o[s]||(n["seek_"+s]=!e)}),n.seek_signup=!e.email||!e.password,n.seek_send=!e.email}function r(){i.register({name:n.input_name,email:n.input_email,password:n.input_password,image:n.imageUrl,gravatar:n.input_gravatar},null,function(e){n.msg=o[e.why]||o.unknown,"email-exists"==e.why&&(n.seek_email=!0),"nick-exists"==e.why&&(n.seek_email=!0),n.showmsg=!0})}i.instance(function(e){e.user&&(n.show_signup=!1,window.location.href="/account")}),n.signup=function(){n.showmsg=!1;var e=t();a(e),e.name&&e.email&&e.password&&e.verify_password?n.input_password==n.input_verify_password?r():(n.msg=o["mismatch-password"],n.showmsg=!0):(n.msg=o["missing-fields"],n.showmsg=!0),n.signup_hit=!0,n.mode="signup"},n.showmsg=!1,n.signup_hit=!1,n.input_email="",n.input_password="",n.input_verify_password="",n.input_gravatar="",n.$watch("input_email",function(){n.seek_email=!1}),n.$watch("input_password",function(){n.seek_password=!1}),n.$watch("input_verify_password",function(){n.seek_verify_password=!1}),n.$watch("input_gravatar",function(){n.seek_gravatar=!1}),n.seek_email=!1,n.seek_password=!1,n.seek_verify_password=!1,n.seek_gravatar=!1}]),n.controller("Forgot",["$scope","$rootScope","auth",function(n,s,i){function t(){return{email:!e(n.input_email)}}function a(e,o){_.each(e,function(e,s){o&&o[s]||(n["seek_"+s]=!e)}),n.seek_forgot=!e.email,n.seek_send=!e.email}function r(){i.reset({email:n.input_email},function(){n.msg=o["reset-sent"],n.showmsg=!0},function(e){n.msg=o[e.why]||o.unknown,n.showmsg=!0,"user-not-found"==e.why&&(n.seek_email=!0)})}i.instance(function(e){e.user&&(n.show_forgot=!1,window.location.href="/account")}),n.forgot=function(){n.showmsg=!1;var e=t();a(e),e.email?r():(n.msg=o["missing-fields"],n.showmsg=!0),n.forgot_hit=!0,n.mode="forgot"},n.showmsg=!1,n.forgot_hit=!1,n.input_email="",n.$watch("input_email",function(){n.seek_email=!1}),n.seek_email=!1}]),n.controller("Reset",["$scope","$http","auth",function(n,s,i){if(n.show_reset){n.show_resetpass=!0,n.show_gohome=!1;var t=window.location.pathname,a=t.replace(/^\/reset\//,"");i.reset_load({token:a},function(e){n.msg=o["activate-reset"],n.nick=e.nick,n.show_reset=!0},function(){n.msg=o["invalid-reset"]}),n.reset=function(){n.seek_password=e(n.input_password),n.seek_repeat=e(n.input_repeat),n.seek_reset=n.seek_password||n.seek_repeat,n.seek_password||n.seek_repeat?n.msg=o["missing-fields"]:i.reset_execute({token:a,password:n.input_password,repeat:n.input_repeat},function(){n.msg=o["reset-done"],n.show_gohome=!0,n.show_resetpass=!1},function(){n.msg=o["invalid-reset"]})},n.gohome=function(){window.location.href="/"},n.goaccount=function(){window.location.href="/account"}}}]),n.controller("Confirm",["$scope","$rootScope","auth",function(e,n,s){if(e.show_confirm){n.$on("instance",function(n,o){e.show_goaccount=!!o.user,e.show_gohome=!o.user});var i=window.location.pathname,t=i.replace(/^\/confirm\//,"");s.confirm({code:t},function(){e.msg=o.confirmed},function(){e.msg=o["invalid-confirm-code"]}),e.gohome=function(){window.location.href="/"},e.goaccount=function(){window.location.href="/account"}}}])}();