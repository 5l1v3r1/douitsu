!function(){function e(e){return null==e||0==""+e}var n=angular.module("home",["cookiesModule"]);n.controller("Main",function(e){var n=window.location.pathname,o=!0,s=0==n.indexOf("/reset"),t=0==n.indexOf("/confirm");o=!t&&!s,e.show_login=o,e.show_reset=s,e.show_confirm=t});var o={unknown:"Unable to perform your request at this time - please try again later.","missing-fields":"Please enter the missing fields.","user-not-found":"That email address is not recognized.","invalid-password":"That password is incorrect","email-exists":"That email address is already in use. Please login, or ask for a password reset.","nick-exists":"That email address is already in use. Please login, or ask for a password reset.","reset-sent":"An email with password reset instructions has been sent to you.","activate-reset":"Please enter your new password.","invalid-reset":"This is not a valid reset.","reset-done":"Your password has been reset.",confirmed:"Your account has been confirmed","invalid-confirm-code":"That confirmation code is not valid."};n.service("auth",function(e,n){return{login:function(o,s,t){e({method:"POST",url:"/auth/login",data:o,cache:!1}).success(function(e){return s?s(e):n.location.href="/account"}).error(function(e){return t?t(e):void 0})},register:function(o,s,t){e({method:"POST",url:"/auth/register",data:o,cache:!1}).success(function(e){return s?s(e):n.location.href="/account"}).error(function(e){return t?t(e):void 0})},instance:function(n,o){e({method:"GET",url:"/auth/instance",cache:!1}).success(function(e){return n?n(e):void 0}).error(function(e){return o?o(e):void 0})},reset:function(n,o,s){e({method:"POST",url:"/auth/create_reset",data:n,cache:!1}).success(function(e){return o?o(e):void 0}).error(function(e){return s?s(e):void 0})},reset_load:function(n,o,s){e({method:"POST",url:"/auth/load_reset",data:n,cache:!1}).success(function(e){return o?o(e):void 0}).error(function(e){return s?s(e):void 0})},reset_execute:function(n,o,s){e({method:"POST",url:"/auth/execute_reset",data:n,cache:!1}).success(function(e){return o?o(e):void 0}).error(function(e){return s?s(e):void 0})},confirm:function(n,o,s){e({method:"POST",url:"/auth/confirm",data:n,cache:!1}).success(function(e){return o?o(e):void 0}).error(function(e){return s?s(e):void 0})}}}),n.controller("Login",function(n,s,t){function i(){return{email:!e(n.input_email),password:!e(n.input_password)}}function r(e,o){_.each(e,function(e,s){o&&o[s]||(n["seek_"+s]=!e)}),n.seek_signin=!e.email||!e.password,n.seek_send=!e.email}function a(){t.login({email:n.input_email,password:n.input_password},null,function(e){n.msg=o[e.why]||o.unknown,n.showmsg=!0,"user-not-found"==e.why&&(n.seek_email=!0),"invalid-password"==e.why&&(n.seek_password=!0)})}function c(){t.reset({email:n.input_email},function(){n.cancel(),n.msg=o["reset-sent"],n.showmsg=!0},function(e){n.msg=o[e.why]||o.unknown,n.showmsg=!0,"user-not-found"==e.why&&(n.seek_email=!0)})}n.signin=function(){n.showmsg=!1;var e=i();r(e,{}),e.email&&e.password?a():(n.msg=o["missing-fields"],n.showmsg=!0),n.signin_hit=!0,n.mode="signin"},n.send=function(){"send"!=n.mode&&show({name:!1,password:!1,signup:!1,signin:!1,cancel:!0,send:!0}),n.send_hit=!0,n.showmsg=!1;var e=i();e.email?c():r(e),n.mode="send"},n.forgot=function(){n.hide_forgot=!0,show({name:!1,password:!1,signup:!1,signin:!1,cancel:!0,send:!0}),n.msg="Enter an email address so that we can send you a reset link.",n.showmsg=!0},n.goaccount=function(){window.location.href="/account"},n.user=null,n.showmsg=!1,n.signin_hit=!1,n.input_email="",n.input_password="",n.$watch("input_email",function(){n.seek_email=!1}),n.$watch("input_password",function(){n.seek_password=!1}),n.seek_email=!1,n.seek_password=!1,n.hasuser=!!n.user,t.instance(function(e){n.user=e.user,n.hasuser=!!n.user,s.$emit("instance",{user:e.user})})}),n.controller("Reset",function(n,s,t){if(n.show_reset){n.show_resetpass=!0,n.show_gohome=!1;var i=window.location.pathname,r=i.replace(/^\/reset\//,"");t.reset_load({token:r},function(e){n.msg=o["activate-reset"],n.nick=e.nick,n.show_reset=!0},function(){n.msg=o["invalid-reset"]}),n.reset=function(){n.seek_password=e(n.input_password),n.seek_repeat=e(n.input_repeat),n.seek_reset=n.seek_password||n.seek_repeat,n.seek_password||n.seek_repeat?n.msg=o["missing-fields"]:t.reset_execute({token:r,password:n.input_password,repeat:n.input_repeat},function(){n.msg=o["reset-done"],n.show_gohome=!0,n.show_resetpass=!1},function(){n.msg=o["invalid-reset"]})},n.gohome=function(){window.location.href="/"},n.goaccount=function(){window.location.href="/account"}}}),n.controller("Confirm",function(e,n,s){if(e.show_confirm){n.$on("instance",function(n,o){e.show_goaccount=!!o.user,e.show_gohome=!o.user});var t=window.location.pathname,i=t.replace(/^\/confirm\//,"");s.confirm({code:i},function(){e.msg=o.confirmed},function(){e.msg=o["invalid-confirm-code"]}),e.gohome=function(){window.location.href="/"},e.goaccount=function(){window.location.href="/account"}}})}();