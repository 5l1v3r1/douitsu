"use strict";!function(){function e(e){return null===e||0===""+e}var n=angular.module("accountControllers",["ngRoute","cookiesModule","configService","senecaSettingsModule","authService","apiService","pubsubService","fileUploadService","validatorService"]);n.controller("Main",["$scope","features","auth","pubsub",function(e,n,i,o){e.show_account=!0,n.account||(e.show_account=!1),e.application_msg="blank",e.details_msg="blank",e.password_msg="blank",i.instance(function(n){e.user=n.user,e.account=n.account,o.publish("user",[n.user]),o.publish("account",[n.account])}),o.subscribe("user",function(n){e.user=n})}]),n.controller("NavBar",["$scope","features","auth","pubsub",function(e,n,i,o){e.btn_applications=function(){o.publish("application.change"),o.publish("view",["Applications"])},n.account&&(e.btn_account=function(){o.publish("view",["Account"])}),e.btn_signout=function(){i.logout()}}]),n.controller("Account",["$scope","features","auth","pubsub","fileUpload","validator",function(n,i,o,a,s,t){function u(e,i){i!==e&&(n.dirty_indicator=!0)}function r(){return{name:!e(n.field_name),email:!e(n.field_email),email_valid:t.email(n.field_email)}}function c(e,i){_.each(e,function(e,o){i&&i[o]||(n["seek_"+o]=!e)}),e.email_valid||(n.seek_email=!0)}function l(){return{name:n.field_name,email:n.field_email,image:n.imageUrl}}function d(){return{password:n.field_password,repeat:n.field_repeat}}function m(){return{name:n.field_org_name,web:n.field_org_web}}i.account&&(a.subscribe("view",function(e){}),a.subscribe("user",function(e){n.field_name=e.name,n.field_email=e.email,n.imageUrl=e.image,n.email=e.email,n.$watch("field_name",u),n.$watch("field_email",u),n.$watch("imageUrl",u)}),a.subscribe("account",function(e){n.field_org_name=e.name,n.field_org_web=e.web}),n.dirty_indicator=!1,n.update_user=function(){var e=r();if(c(e),e.name&&e.email)if(e.email_valid){var i=l();n.email===i.email&&delete i.email,o.update_user(i,function(e){n.dirty_indicator=!1,n.details_msg="msg.user-updated",a.publish("user",[e.user])},function(e){n.details_msg=e.why?"msg."+e.why:"msg.unknown"})}else n.details_msg="msg.invalid-email";else n.details_msg="msg.missing-fields"},n.change_pass=function(){if(t.password(n.field_password))if(n.field_password===n.field_repeat){var e=d();o.change_password(e,function(){n.password_msg="msg.password-updated"},function(e){n.password_msg=e.why?"msg."+e.why:"msg.unknown"})}else n.password_msg="msg.mismatch-password";else n.password_msg="msg.weak-password"},n.update_org=function(){var e=m();o.update_org(e,function(e){n.org_msg="msg.org-updated",a.publish("account",[e.account])},function(e){n.org_msg=e.why?"msg."+e.why:"msg.unknown"})},n.removeImage=function(){n.imageUrl=""},n.onFileSelect=function(e){n.details_msg="blank";for(var i=function(e){e?n.imageUrl=e.url:n.details_msg="msg.upload-failed"},o=0;o<e.length;o++){var a=e[o];s.isImage(a)?n.upload=s.upload(n,a,i):n.details_msg="msg.only-images-allowed"}})}]),n.controller("TabView",["$scope","$route","$location","pubsub",function(e,n,i,o){var a=["Dashboard","Applications","Settings","Account"];e.views=_.filter(a,function(e){return"Account"!==e}),o.subscribe("view",function(n){console.log("fired:"+n),_.each(a,function(i){e["show_view_"+i]=n===i}),e.curtab=n,i.path(n)}),e.tabview=function(e){o.publish("view",[e])},e.$on("$routeChangeSuccess",function(n,i){i.tab&&e.curtab!==i.tab&&e.tabview(i.tab)})}]),n.controller("Applications",["$scope","auth","api","pubsub","fileUpload","validator",function(n,i,o,a,s,t){function u(){r(),c()}function r(){i.instance(function(e){o.get("/api/rest/application?account="+e.account.id,function(e){n.applications=e})})}function c(){o.get("/api/user/application",function(e){n.user_applications=e.applications})}function l(){n.dirty_indicator=!1,d(),n.unwatch=[],n.unwatch.push(n.$watch("field_name",m)),n.unwatch.push(n.$watch("field_homeurl",m)),n.unwatch.push(n.$watch("field_callback",m)),n.unwatch.push(n.$watch("field_desc",m)),n.unwatch.push(n.$watch("imageUrl",m))}function d(){if(n.dirty_indicator=!1,n.unwatch)for(var e=0;e<n.unwatch.length;e++)n.unwatch[e]()}function m(e,i){i!==e&&(n.dirty_indicator=!0)}function p(){return{name:!e(n.field_name),homeurl:!e(n.field_homeurl),homeurl_valid:t.url(n.field_homeurl),callback:!e(n.field_callback),callback_valid:t.url(n.field_callback),desc:!e(n.field_desc)}}function f(e,i){_.each(e,function(e,o){i&&i[o]||(n["seek_"+o]=!e)}),e.homeurl_valid||(n.seek_homeurl=!0),e.callback_valid||(n.seek_callback=!0)}function g(){return{account:n.account.id,name:n.field_name,appid:n.appid,secret:n.secret,homeurl:n.field_homeurl,callback:n.field_callback,desc:n.field_desc,image:n.imageUrl}}n.applications=[],n.show_applications_list=!0,n.show_application_details=!1,n.dirty_indicator=!1,n.new_application=function(){n.open_application()},n.open_application=function(e){void 0!==e?o.get("/api/rest/application/"+e,function(e){n.dirty_indicator=!1,n.show_application(e)}):n.show_application()},n.show_application=function(e){n.application=e=e||{},n.field_name=e.name,n.field_homeurl=e.homeurl,n.field_callback=e.callback,n.field_desc=e.desc,n.appid=e.appid,n.secret=e.secret,n.imageUrl=e.image,n.show_applications_list=!1,n.show_application_details=!0,n.application_msg="blank",l()},n.close_application=function(){n.show_applications_list=!0,n.show_application_details=!1},n.save_application=function(){var e=p();f(e),e.name&&e.homeurl&&e.callback&&e.desc?e.homeurl_valid&&e.callback_valid?(n.application=_.extend(n.application,g()),o.post("/api/rest/application",n.application,function(e){n.show_application(e),n.application_msg="msg.application-updated",a.publish("application.change",[e])},function(e){n.application_msg=e.why?"msg."+e.why:"msg.unknown"})):n.application_msg="msg.invalid-url":n.application_msg="msg.missing-fields"},n.delete_application=function(e){confirm("Are you sure?")&&o.del("/api/rest/application/"+e,function(){n.application_msg="msg.application-deleted",a.publish("application.change",[])},function(e){n.application_msg=e.why?"msg."+e.why:"msg.unknown"})},n.revoke_user_application=function(e){confirm("Are you sure?")&&o.del("/api/user/application/"+e,function(){a.publish("application.change",[])},function(e){n.token_msg=e.why?"msg."+e.why:"msg.unknown"})},n.removeImage=function(){n.imageUrl=""},n.onFileSelect=function(e){n.application_msg="blank";for(var i=function(e){e?n.imageUrl=e.url:n.details_msg="msg.upload-failed"},o=0;o<e.length;o++){var a=e[o];s.isImage(a)?n.upload=s.upload(n,a,i):n.application_msg="msg.only-images-allowed"}},u(),a.subscribe("application.change",u)}])}(),function(){var e=angular.module("account",["ngRoute","configService","accountControllers","i18nModule"]);e.config(["$routeProvider","features",function(e,n){e.when("/Applications",{tab:"Applications"}),e.when("/Settings",{tab:"Settings"}),n.account&&e.when("/Account",{tab:"Account"}),e.otherwise({tab:"Applications"})}])}(),function(){var e=angular.module("apiService",[]);e.service("api",["$http",function(e){return{get:function(e,n,i){this.call("GET",e,null,null,n,i)},post:function(e,n,i,o){this.call("POST",e,n,null,i,o)},del:function(e,n,i){this.call("DELETE",e,null,null,n,i)},call:function(n,i,o,a,s,t){var u={method:n,url:i,data:o,cache:!1};e(u).success(function(e){return s?s(e):void 0}).error(function(e){return t?t(e):void 0})}}}])}(),function(){var e=angular.module("authService",[]);e.service("auth",["$http","$window",function(e,n){return{login:function(i,o,a){e({method:"POST",url:"/auth/login",data:i,cache:!1}).success(function(e){return o?o(e):void(n.location.href="/account")}).error(function(e){return a?a(e):void 0})},register:function(i,o,a){e({method:"POST",url:"/auth/register",data:i,cache:!1}).success(function(e){return o?o(e):void(n.location.href="/account")}).error(function(e){return a?a(e):void 0})},instance:function(n,i){e({method:"GET",url:"/auth/instance",cache:!1}).success(function(e){return n?n(e):void 0}).error(function(e){return i?i(e):void 0})},reset:function(n,i,o){e({method:"POST",url:"/auth/create_reset",data:n,cache:!1}).success(function(e){return i?i(e):void 0}).error(function(e){return o?o(e):void 0})},reset_load:function(n,i,o){e({method:"POST",url:"/auth/load_reset",data:n,cache:!1}).success(function(e){return i?i(e):void 0}).error(function(e){return o?o(e):void 0})},reset_execute:function(n,i,o){e({method:"POST",url:"/auth/execute_reset",data:n,cache:!1}).success(function(e){return i?i(e):void 0}).error(function(e){return o?o(e):void 0})},confirm:function(n,i,o){e({method:"POST",url:"/auth/confirm",data:n,cache:!1}).success(function(e){return i?i(e):void 0}).error(function(e){return o?o(e):void 0})},logout:function(i,o){e({method:"POST",url:"/auth/logout",cache:!1}).success(function(e){return i?i(e):void(n.location.href="/")}).error(function(e){return o?o(e):void 0})},change_password:function(n,i,o){e({method:"POST",url:"/auth/change_password",data:n,cache:!1}).success(function(e){return i?i(e):void 0}).error(function(e){return o?o(e):void 0})},update_user:function(n,i,o){e({method:"POST",url:"/auth/update_user",data:n,cache:!1}).success(function(e){return i?i(e):void 0}).error(function(e){return o?o(e):void 0})},update_org:function(n,i,o){e({method:"POST",url:"/account/update",data:n,cache:!1}).success(function(e){return i?i(e):void 0}).error(function(e){return o?o(e):void 0})}}}])}(),function(){angular.module("configService",[]).constant("features",features)}();var cookiesModule=angular.module("cookiesModule",[]);cookiesModule.constant("infinity_date","Fri, 31 Dec 9999 23:59:59 GMT"),cookiesModule.factory("Cookies",["infinity_date",function(e){return{getItem:function(e){return decodeURI(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURI(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null},setItem:function(n,i,o,a,s,t){if(!n||/^(?:expires|max\-age|path|domain|secure)$/i.test(n))return!1;var u="";if(o)switch(o.constructor){case Number:u=1/0===o?"; expires="+e:"; max-age="+o;break;case String:u="; expires="+o;break;case Date:u="; expires="+o.toGMTString()}return document.cookie=encodeURI(n)+"="+encodeURI(i)+u+(s?"; domain="+s:"")+(a?"; path="+a:"")+(t?"; secure":""),!0},removeItem:function(e,n){return e&&this.hasItem(e)?(document.cookie=encodeURI(e)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT"+(n?"; path="+n:""),!0):!1},hasItem:function(e){return new RegExp("(?:^|;\\s*)"+encodeURI(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=").test(document.cookie)},keys:function(){for(var e=document.cookie.replace(/((?:^|\s*;)[^\=]+)(?=;|$)|^\s*|\s*(?:\=[^;]*)?(?:\1|$)/g,"").split(/\s*(?:\=[^;]*)?;\s*/),n=0;n<e.length;n++)e[n]=decodeURI(e[n]);return e}}}]),function(){var e=angular.module("fileUploadService",["angularFileUpload"]);e.service("fileUpload",["$upload",function(e){return{isImage:function(e){var n=["jpeg","jpg","png","gif","bmp"];return-1!==$.inArray(e.name.split(".").pop().toLowerCase(),n)},upload:function(n,i,o){return n.show_progress=!0,n.progress="0%",e.upload({url:"/upload",file:i}).progress(function(e){n.progress=parseInt(100*e.loaded/e.total)+"%"}).success(function(e){n.show_progress=!1,n.progress="0%",o(e)}).error(function(e){n.show_progress=!1,n.progress="0%",o(null,e)})}}}])}(),i18n.init({lng:languages[0],useCookie:!1,useLocalStorage:!1,resGetPath:"/locales/__lng__/__ns__.json",fallbackLng:"en",ns:locale.namespace||"translation"},function(){$(".container").i18n()}),function(){var e=angular.module("i18nModule",["jm.i18next"]);e.config(["$i18nextProvider",function(e){e.options={lng:languages[0],useCookie:!1,useLocalStorage:!1,resGetPath:"../locales/__lng__/__ns__.json",fallbackLng:"en",ns:locale.namespace||"translation"}}])}(),function(){var e=angular.module("pubsubService",[]);e.service("pubsub",function(){var e={};return{publish:function(n,i){e[n]&&$.each(e[n],function(){this.apply(null,i||[])})},subscribe:function(n,i){return e[n]||(e[n]=[]),e[n].push(i),[n,i]},unsubscribe:function(n){var i=n[0];e[i]&&$.each(e[i],function(o){this===n[1]&&e[i].splice(o,1)})}}})}(),function(){var e=angular.module("validatorService",[]);e.service("validator",function(){return{email:function(e){return/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e)},password:function(e){return e&&e.length>=6},url:function(e){return/^(https?):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)*(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(e)}}})}(),function(){function e(e){return null===e||0===""+e}var n=angular.module("dialogControllers",["authService","validatorService"]);n.controller("Main",["$scope","$http","auth","validator",function(n,i,o,a){function s(){n.msg="blank",n.name="",n.email="",n.password="",n.verifyPassword="",t()}function t(){n.seek_name=!1,n.seek_email=!1,n.seek_password=!1,n.seek_verifyPassword=!1}s(),o.instance(function(e){e.user?n.user=e.user:n.show_signin=!0}),n.btn_signin=function(){s(),n.show_signin=!0,n.show_signup=!1},n.btn_signup=function(){s(),n.show_signin=!1,n.show_signup=!0},$("#allow").on("click",function(e){e.preventDefault(),e.returnValue=!1}),n.btn_allow=function(){if(t(),!n.show_signin&&!n.show_signup)return void $("#dialogForm").submit();if(n.show_signin)if(e(n.email)||e(n.password))n.seek_email=e(n.email),n.seek_password=e(n.password),n.msg="msg.missing-fields";else{var o={email:n.email,password:n.password};i({method:"POST",url:"/auth/login",data:o,cache:!1}).success(function(){$("#dialogForm").submit()}).error(function(e){n.msg=e.why?"msg."+e.why:"msg.signin-failed"})}if(n.show_signup)if(e(n.name)||e(n.email)||e(n.password)||e(n.verifyPassword))n.seek_name=e(n.name),n.seek_email=e(n.email),n.seek_password=e(n.password),n.seek_verifyPassword=e(n.verifyPassword),n.msg="msg.missing-fields";else if(a.email(n.email))if(a.password(n.password))if(n.password!==n.verifyPassword)n.seek_password=!0,n.seek_verifyPassword=!0,n.msg="msg.mismatch-password";else{var s={name:n.name,email:n.email,password:n.password};i({method:"POST",url:"/auth/register",data:s,cache:!1}).success(function(){$("#dialogForm").submit()}).error(function(e){n.msg=e.why?"msg."+e.why:"msg.signup-failed"})}else n.seek_password=!0,n.msg="msg.weak-password";else n.seek_email=!0,n.msg="msg.invalid-email"}}])}(),function(){angular.module("dialog",["dialogControllers","i18nModule"])}(),function(){function e(e){return null===e||0===""+e}var n=angular.module("homeControllers",["cookiesModule","configService","authService","fileUploadService","angular-md5","validatorService"]);n.controller("Main",["$scope","$location","features",function(e,n,i){var o=window.location.pathname,a=!0,s=0===o.indexOf("/signup"),t=0===o.indexOf("/forgot"),u=0===o.indexOf("/reset"),r=0===o.indexOf("/confirm"),c=0===o.indexOf("/doconfirm");return s&&!i.signup?void(window.location.href="/"):(a=!(s||t||r||u||c),e.show_login=a,e.show_signup=s,e.show_forgot=t,e.show_reset=u,e.show_confirm=r,e.show_doconfirm=c,void(e.msg="blank"))}]),n.controller("Login",["$scope","$rootScope","auth","features",function(n,i,o,a){function s(){return{email:!e(n.input_email),password:!e(n.input_password)}}function t(e,i){_.each(e,function(e,o){i&&i[o]||(n["seek_"+o]=!e)}),n.seek_signin=!e.email||!e.password,n.seek_send=!e.email}function u(){var e=n.input_email;o.login({email:e,password:n.input_password},null,function(i){"user-not-confirmed"===i.why?window.location.href="/doconfirm/"+e:(n.msg=i.why?"msg."+i.why:"msg.unknown",n.showmsg=!0,"user-not-found"===i.why&&(n.seek_email=!0),"invalid-password"===i.why&&(n.seek_password=!0))})}function r(){o.reset({email:n.input_email},function(){n.cancel(),n.msg="msg.reset-sent",n.showmsg=!0},function(e){n.msg=e.why?"msg."+e.why:"msg.unknown",n.showmsg=!0,"user-not-found"===e.why&&(n.seek_email=!0)})}function c(e){_.each(e,function(e,i){n["hide_"+i]=!e,e&&!l[i]&&(l[i]=!0,n["fadeout_"+i]=!1,n["fadein_"+i]=!0),!e&&l[i]&&(l[i]=!1,n["fadein_"+i]=!1,n["fadeout_"+i]=!0)}),e.cancel&&(n.float_cancel=n.fadein_signup?"right":"left")}n.signup_enabled=a.signup,n.signin=function(){n.showmsg=!1;var e=s();t(e,{}),e.email&&e.password?u():(n.msg="msg.missing-fields",n.showmsg=!0),n.signin_hit=!0,n.mode="signin"};var l={name:!0,email:!0,password:!0,forgot:!0,signup:!0,signin:!0,cancel:!1};n.send=function(){"send"!==n.mode&&c({name:!1,password:!1,signup:!1,signin:!1,cancel:!0,send:!0}),n.send_hit=!0,n.showmsg=!1;var e=s();e.email?r():t(e),n.mode="send"},n.forgot=function(){window.location.href="/forgot"},n.goaccount=function(){window.location.href="/account"},n.signup=function(){window.location.href="/signup"},n.user=null,n.showmsg=!1,n.signin_hit=!1,n.input_email="",n.input_password="",n.$watch("input_email",function(){n.seek_email=!1}),n.$watch("input_password",function(){n.seek_password=!1}),n.seek_email=!1,n.seek_password=!1,n.hasuser=!!n.user,o.instance(function(e){n.user=e.user,n.hasuser=!!n.user,i.$emit("instance",{user:e.user})})}]),n.controller("Signup",["$scope","$rootScope","auth","fileUpload","features","md5","validator",function(n,i,o,a,s,t,u){function r(){return{name:!e(n.input_name),email:!e(n.input_email),email_valid:u.email(n.input_email),password:!e(n.input_password),password_valid:u.password(n.input_password),verify_password:!e(n.input_verify_password)}}function c(e,i){_.each(e,function(e,o){i&&i[o]||(n["seek_"+o]=!e)}),e.email_valid||(n.seek_email=!0),e.password_valid||(n.seek_password=!0),n.seek_signup=!e.email||!e.password,n.seek_send=!e.email}function l(e){return s.gravatar?"//www.gravatar.com/avatar/"+t.createHash(e.toLowerCase().trim())+"?d=blank&s=200":null}function d(){var e=n.input_email;o.register({name:n.input_name,email:e,password:n.input_password,image:n.imageUrl||l(n.input_email)},null,function(i){"user-not-confirmed"===i.why?window.location.href="/doconfirm/"+e:(n.msg=i.why?"msg."+i.why:"msg.unknown","email-exists"===i.why&&(n.seek_email=!0),"nick-exists"===i.why&&(n.seek_email=!0),n.showmsg=!0)})}o.instance(function(e){e.user&&(n.show_signup=!1,window.location.href="/account")}),n.signup=function(){n.showmsg=!1;var e=r();c(e),e.name&&e.email&&e.password&&e.verify_password?e.email_valid&&e.password_valid&&n.input_password===n.input_verify_password?d():e.email_valid?e.password_valid?(n.msg="msg.mismatch-password",n.showmsg=!0):(n.msg="msg.weak-password",n.showmsg=!0):(n.msg="msg.invalid-email",n.showmsg=!0):(n.msg="msg.missing-fields",n.showmsg=!0),n.signup_hit=!0,n.mode="signup"},n.removeImage=function(){n.imageUrl=""},n.onFileSelect=function(e){n.showmsg=!1;for(var i=function(e){e?n.imageUrl=e.url:n.details_msg="msg.upload-failed"},o=0;o<e.length;o++){var s=e[o];a.isImage(s)?n.upload=a.upload(n,s,i):(n.msg="msg.only-images-allowed",n.showmsg=!0)}},n.showmsg=!1,n.signup_hit=!1,n.input_email="",n.input_password="",n.input_verify_password="",n.$watch("input_email",function(){n.seek_email=!1}),n.$watch("input_password",function(){n.seek_password=!1}),n.$watch("input_verify_password",function(){n.seek_verify_password=!1}),n.seek_email=!1,n.seek_password=!1,n.seek_verify_password=!1}]),n.controller("Forgot",["$scope","$rootScope","auth",function(n,i,o){function a(){return{email:!e(n.input_email)}}function s(e,i){_.each(e,function(e,o){i&&i[o]||(n["seek_"+o]=!e)}),n.seek_forgot=!e.email,n.seek_send=!e.email}function t(){o.reset({email:n.input_email},function(){n.msg="msg.reset-sent",n.showmsg=!0},function(e){n.msg=e.why?"msg."+e.why:"msg.unknown",n.showmsg=!0,"user-not-found"===e.why&&(n.seek_email=!0)})}o.instance(function(e){e.user&&(n.show_forgot=!1,window.location.href="/account")}),n.forgot=function(){n.showmsg=!1;var e=a();s(e),e.email?t():(n.msg="msg.missing-fields",n.showmsg=!0),n.forgot_hit=!0,n.mode="forgot"},n.showmsg=!1,n.forgot_hit=!1,n.input_email="",n.$watch("input_email",function(){n.seek_email=!1}),n.seek_email=!1}]),n.controller("Reset",["$scope","$http","auth",function(n,i,o){if(n.show_reset){n.show_resetpass=!0,n.show_gohome=!1;var a=window.location.pathname,s=a.replace(/^\/reset\//,"");o.reset_load({token:s},function(e){n.msg="msg.activate-reset",n.nick=e.nick,n.show_reset=!0},function(){n.msg="msg.invalid-reset"}),n.reset=function(){n.seek_password=e(n.input_password),n.seek_repeat=e(n.input_repeat),n.seek_reset=n.seek_password||n.seek_repeat,n.seek_password||n.seek_repeat?n.msg="msg.missing-fields":o.reset_execute({token:s,password:n.input_password,repeat:n.input_repeat},function(){n.msg="msg.reset-done",n.show_gohome=!0,n.show_resetpass=!1},function(){n.msg="msg.invalid-reset"})},n.gohome=function(){window.location.href="/"},n.goaccount=function(){window.location.href="/account"}}}]),n.controller("Confirm",["$scope","$rootScope","auth",function(e,n,i){if(e.show_confirm){n.$on("instance",function(n,i){e.show_goaccount=!!i.user,e.show_gohome=!i.user});var o=window.location.pathname,a=o.replace(/^\/confirm\//,"");i.confirm({code:a},function(){e.msg="msg.confirmed"},function(){e.msg="msg.invalid-confirm-code"}),e.gohome=function(){window.location.href="/"},e.goaccount=function(){window.location.href="/account"}}}]),n.controller("DoConfirm",["$scope","$rootScope","auth",function(e){if(e.show_doconfirm){var n=window.location.pathname;e.email=n.replace(/^\/doconfirm\//,"")}}])}(),function(){angular.module("home",["homeControllers","i18nModule"])}();